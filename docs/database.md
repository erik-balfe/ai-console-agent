# Database Structure Documentation for AI Console Agent

This documentation outlines the structure of the database used by the AI Console Agent, including tables, relationships, and data types. The database is designed to track user interactions, agent actions, and tool usages efficiently.

## Overview

The database consists of the following primary tables:

1. **conversations**
2. **agent_steps**
3. **tool_uses**
4. **db_version** (optional, used for tracking database schema versioning)

---

## Tables and Relationships

### 1. Conversations Table

- **Table Name**: `conversations`
- **Purpose**: Stores each user interaction as a unique conversation.
- **Columns**:
  - `id`: (INTEGER, Primary Key) Unique identifier for each conversation.
  - `user_query`: (TEXT) The query inputted by the user (e.g., "What is my version of Thunderbird?").
  - `timestamp`: (BIGINT) The time when the conversation started.
  - `user_feedback`: (TEXT, optional) Any feedback from the user after the conversation is completed.
  - `total_time`: (INTEGER, optional) Total time taken for the conversation.

### 2. Agent Steps Table

- **Table Name**: `agent_steps`
- **Purpose**: Logs individual steps taken by the agent during the conversation.
- **Columns**:
  - `id`: (INTEGER, Primary Key) Unique identifier for each agent step.
  - `conversation_id`: (INTEGER, Foreign Key) Links to the `id` of the `conversations` table, establishing which conversation the step belongs to.
  - `step_number`: (INTEGER) Represents the order of the step in the conversation.
  - `content`: (TEXT) The response generated by the agent for this step.
  - `timestamp`: (BIGINT) The timestamp of when this step was logged.
  - `execution_time`: (INTEGER) Time taken to execute this step.
  - `role`: (TEXT) Identifies the role of the entity that produced the step (e.g., "AGENT", "USER", "SYSTEM").

### 3. Tool Usages Table

- **Table Name**: `tool_uses`
- **Purpose**: Logs details about each tool that is executed during agent steps.
- **Columns**:
  - `id`: (INTEGER, Primary Key) Unique identifier for each tool usage.
  - `step_id`: (INTEGER, Foreign Key) Links to the `id` of the `agent_steps` table, indicating which agent step the tool usage is associated with.
  - `tool_name`: (TEXT) The name of the tool being executed (e.g., `executeCommand`, `askUser`).
  - `input_params`: (TEXT) The parameters passed to the tool as input, stored in JSON format.
  - `output`: (TEXT) The output produced by the tool after execution, stored in JSON format.
  - `timestamp`: (BIGINT) The time at which the tool was executed.
  - `execution_time`: (INTEGER) The time taken for the tool to execute.

### 4. DB Version Table (Optional)

- **Table Name**: `db_version`
- **Purpose**: Tracks the schema version of the database.
- **Columns**:
  - `version`: (INTEGER, Primary Key) The current version number of the database schema.

---

## Visual Representation of the Schema

```
+-----------------+                +---------------------+
|  conversations  |                |     agent_steps     |
|-----------------|                |---------------------|
| id (PK)         |<-------------->| id (PK)             |
| user_query      |                | conversation_id (FK)|
| timestamp       |                | step_number         |
| user_feedback    |               | content             |
| total_time      |                | timestamp           |
|                 |                | execution_time      |
|                 |                | role                |
+-----------------+                +---------------------+
                                    |
                                    |
                                    v
                             +--------------------+
                             |     tool_uses      |
                             |--------------------|
                             | id (PK)            |
                             | step_id (FK)      |
                             | tool_name          |
                             | input_params       |
                             | output             |
                             | timestamp          |
                             | execution_time     |
                             +--------------------+
```

---

## Connections Between Tables

1. **Conversations to Agent Steps**:

   - The `conversation_id` in the `agent_steps` table links each step back to its source conversation, ensuring that every step is associated with the correct interaction.

2. **Agent Steps to Tool Usages**:
   - The `step_id` in the `tool_uses` table connects each tool invocation to the specific agent step that initiated it, allowing full traceability of tool interactions related to user queries.

---

## Summary

This structured database design provides a comprehensive way to track user interactions with the AI Console Agent, allowing both for auditing of past conversations and for potential analysis and improvements in the agent's responses. Each piece of data is kept coherent and connected, ensuring optimal performance and usability.
